# –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞ ‚Ññ13 (–∫ –∑–∞–Ω—è—Ç–∏—é –æ—Ç 12.10.23)
[–†–∞–±–æ—Ç–∞ —Å join'–∞–º–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π]

- [x] –ò—Å–ø–æ–ª—å–∑—É—é —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã "postgres2" —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ YC (–û–°:Ubuntu 22.04, HDD 10Gb, RAM 4Gb);
- [x] –î–æ–±–∞–≤–ª–µ–Ω ssh –∫–ª—é—á –≤ metadata –í–ú yc_key.pub;
- [x] –†–∞–∑–≤–µ—Ä–Ω—É—Ç –∫–ª–∞—Å—Ç–µ—Ä –ë–î PostgreSQL 15;

`silunsky@postgres:~$ pg_lsclusters`

`Ver Cluster Port Status Owner    Data directory              Log file`

`15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log`

- [x] –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—É—é –±–∞–∑—É –ü–µ—Ä–µ–ª–µ—Ç—ã, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –î–ó –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é.
‚ö†Ô∏è –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–∑—è—Ç–∞ —Å edu.postgrespro.ru: demo-big.zip (232 –ú–ë) ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–ª—ë—Ç–∞–º –∑–∞ –≥–æ–¥ (—Ä–∞–∑–º–µ—Ä –ë–î –æ–∫–æ–ª–æ 2,5 –ì–ë)
–§–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç SQL-—Å–∫—Ä–∏–ø—Ç, —Å–æ–∑–¥–∞—é—â–∏–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö demo –∏ –Ω–∞–ø–æ–ª–Ω—è—é—â–∏–π –µ—ë –¥–∞–Ω–Ω—ã–º–∏ (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏, —ç—Ç–æ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —É—Ç–∏–ª–∏—Ç–æ–π pg_dump). –í–ª–∞–¥–µ–ª—å—Ü–µ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö demo —Å—Ç–∞–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –°–£–ë–î, –≤—ã–ø–æ–ª–Ω—è–≤—à–∏–π —Å–∫—Ä–∏–ø—Ç. –í –∫–ª–∞—Å—Ç–µ—Ä–µ `15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log` —Å–æ–∑–¥–∞–Ω–∞ –ë–î **demo**

List of relations

|  Schema  |      Name       | Type  |  Owner   |
|----------|-----------------|-------|----------|
| bookings | aircrafts_data  | table | postgres |
| bookings | airports_data   | table | postgres |
| bookings | boarding_passes | table | postgres |
| bookings | bookings        | table | postgres |
| bookings | flights         | table | postgres |
| bookings | seats           | table | postgres |
| bookings | ticket_flights  | table | postgres |
| bookings | tickets         | table | postgres |
(8 rows)

`demo=# select pg_size_pretty(pg_table_size('flights'));`

| pg_size_pretty | 
|----------------|
| 21 MB          |
(1 row)

`demo=# select pg_size_pretty(pg_table_size('tickets'));`

| pg_size_pretty  | 
|---------------- |
| 386 MB          |
(1 row)

`demo=# select pg_size_pretty(pg_table_size('bookings'));`

| pg_size_pretty| 
|---------------|
| 105 MB        |
(1 row)

- [x] –ü—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ –æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Ç–∞–±–ª–∏—Ü **bookings** –∏ **tickets** –±–∞–∑—ã –¥–≤–Ω–Ω—ã—Ö **demo**

`demo=# \d bookings`

Table "bookings.bookings"
|    Column    |           Type           | Collation | Nullable | Default |
|--------------|--------------------------|-----------|----------|---------|
| book_ref     | character(6)             |           | not null |         |
| book_date    | timestamp with time zone |           | not null |         |
| total_amount | numeric(10,2)            |           | not null |         |
|Indexes:     "bookings_pkey" PRIMARY KEY, btree (book_ref)|
|Referenced by:     TABLE "tickets" CONSTRAINT "tickets_book_ref_fkey" FOREIGN KEY (book_ref) REFERENCES bookings(book_ref)|

`demo=# \d tickets`

Table "bookings.tickets"
|     Column     |         Type          | Collation | Nullable | Default |
|----------------|-----------------------|-----------|----------|---------|
| ticket_no      | character(13)         |           | not null |         |
| book_ref       | character(6)          |           | not null |         | 
| passenger_id   | character varying(20) |           | not null |         |
| passenger_name | text                  |           | not null |         |
| contact_data   | jsonb                 |           |          |         |
|Indexes:     "tickets_pkey" PRIMARY KEY, btree (ticket_no)|
|Foreign-key constraints:     "tickets_book_ref_fkey" FOREIGN KEY (book_ref) REFERENCES bookings(book_ref)|
|Referenced by:     TABLE "ticket_flights" CONSTRAINT "ticket_flights_ticket_no_fkey" FOREIGN KEY (ticket_no) REFERENCES tickets(ticket_no)|

`demo=# \d boarding_passes`

 Table "bookings.boarding_passes"
|   Column    |         Type         | Collation | Nullable | Default |
|-------------|----------------------|-----------|----------|---------|
| ticket_no   | character(13)        |           | not null |         |
| flight_id   | integer              |           | not null |         |
| boarding_no | integer              |           | not null |         |
| seat_no     | character varying(4) |           | not null |         |

Indexes:

"boarding_passes_pkey" PRIMARY KEY, btree (ticket_no, flight_id)

"boarding_passes_flight_id_boarding_no_key" UNIQUE CONSTRAINT, btree (flight_id, boarding_no)

"boarding_passes_flight_id_seat_no_key" UNIQUE CONSTRAINT, btree (flight_id, seat_no)

Foreign-key constraints:

"boarding_passes_ticket_no_fkey" FOREIGN KEY (ticket_no, flight_id) REFERENCES ticket_flights(ticket_no, flight_id)

---

- [x] –¢–µ–ø–µ—Ä—å, –ø–æ–Ω–∏–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∞–±–ª–∏—Ü—ã **bookings.bookings**, **bookings.tickets** –∏ **bookings.boarding_passes**, —Ä–µ–∞–ª–∏–∑—É–µ–º –ø—Ä—è–º–æ–µ `INNER JOIN` —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –∏–ª–∏ –±–æ–ª–µ–µ —Ç–∞–±–ª–∏—Ü. –í –º–æ—ë–º —Å–ª—É—á–∞–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ 3-—Ö —Ç–∞–±–ª–∏—Ü. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏–º —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

`demo=# SELECT tic.passenger_id,tic.passenger_name, boar.seat_no, book.book_date`

`FROM tickets AS tic`

`INNER JOIN boarding_passes AS boar ON tic.ticket_no=boar.ticket_no`

`INNER JOIN bookings AS book ON tic.book_ref=book.book_ref`

`limit 2;`

| passenger_id | passenger_name  | seat_no |       book_date        |
|--------------|-----------------|---------|------------------------|
| 4246 392925  | KIRILL CHERNOV  | 4A      | 2016-09-13 10:06:00+00 |
| 6027 630039  | ALEKSEY NIKITIN | 23F     | 2016-09-10 22:23:00+00 |
(2 rows)

üòÑ –ó–∞–ø—Ä–æ—Å —Å–æ–µ–¥–∏–Ω—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É –±–∏–ª–µ—Ç–æ–≤(tickets) —Å —Ç–∞–±–ª–∏—Ü–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π(bookings) –∏ —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ—Å—Å–∞–∂–∏—Ä–æ–≤ –Ω–∞ –±–æ—Ä—Ç—É —Å–∞–º–æ–ª–µ—Ç–∞(boarding_passes): –º—ã –ø–æ–ª—É—á–∏–ª–∏ –≤ –≤—ã–≤–æ–¥–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ 3-—Ö —Ç–∞–±–ª–∏—Ü –æ —Ç–æ–º, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ –≤ —Å–∞–º–æ–ª–µ—Ç–µ.

---
- [x] –î–∞–ª–µ–µ, —Ä–µ–∞–ª–∏–∑—É–µ–º –ª–µ–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ `LEFT JOIN` —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –∏–ª–∏ –±–æ–ª–µ–µ —Ç–∞–±–ª–∏—Ü. –í –º–æ—ë–º —Å–ª—É—á–∞–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ 3-—Ö —Ç–∞–±–ª–∏—Ü. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏–º —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

`demo=# SELECT tic.passenger_id,tic.passenger_name, boar.seat_no, book.book_date`

`FROM tickets AS tic `

`LEFT JOIN boarding_passes AS boar ON tic.ticket_no=boar.ticket_no`

`LEFT JOIN bookings AS book ON tic.book_ref=book.book_ref`

`limit 3;`

| passenger_id | passenger_name  | seat_no |       book_date         |
|--------------|-----------------|---------|------------------------ |
| 4030 855525  | MIKHAIL SEMENOV | 10C     | 2016-08-01 05:07:00+00  |
| 8360 311602  | ELENA ZAKHAROVA | 2A      | 2016-08-05 08:05:00+00  |
| 4510 377533  | ILYA PAVLOV     | 10E     | 2016-07-30 12:20:00+00  |
(3 rows)

üòÑ !!!!–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.
---
