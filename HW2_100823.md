# Домашняя работа №2 (к занятию от 10.08.23)
## [работа с Docker]

В виртуальной машине(ВМ) в YC выведем список кластеров БД, с помощью команды:

`silunsky@postgres:~$ sudo pg_lsclusters `

`Ver Cluster Port Status Owner    Data directory              Log file`

`15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log`

Удалим кластер с помощью команд:
`sudo pg_ctlcluster 15 main stop`

`sudo pg_dropcluster 15 main`
проверяем, что кластер успешно удален:
`silunsky@postgres:~$ sudo pg_lsclusters `

корректный выод команды:
`Ver Cluster Port Status Owner Data directory Log file`

Установим **docker** и **doker comppose**, выполнив команды:

`curl -fsSL https://get.docker.com -o get-docker.sh && sudo sh get-docker.sh && rm get-docker.sh && sudo usermod -aG docker $USER && newgrp docker`

`sudo apt install docker-compose -y`

- проверим корректность работы службы - сервис в статусе *active*:

`silunsky@postgres:~$ systemctl status docker.service` 

`    ● docker.service - Docker Application Container Engine`

     `Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)`

     `Active: active (running) since Sat 2023-08-12 15:21:11 UTC; 6min ago`

`    TriggeredBy: ● docker.socket`

- Создана docker-сеть с помощью команды:
silunsky@postgres:~$ sudo docker network create pg-net-silunsky
c91dadd58948e81b6fb5c5c99be3efc4ad6495a1dab41f571bec2be26092955d

- Созданная сеть подключена к контейнеру сервера Postgres с помощью команды:

silunsky@postgres:~$ sudo docker run --name pg-server --network pg-net-silunsky -e POSTGRES_PASSWORD=1 -d -p 5432:5432 -v /var/lib/postgres:/var/lib/postgresql/data postgres:15

- Запускаем отдельный контейнер с клиентом в общей сети с БД:
silunsky@postgres:~$ sudo docker run -it --rm --network pg-net-silunsky --name pg-client postgres:15 psql -h pg-server -U postgres

- Проверка, что подключились через отдельный контейнер:
silunsky@postgres:~$ sudo docker ps -a
CONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS         PORTS                                       NAMES
3ecab0822920   postgres:15   "docker-entrypoint.s…"   6 minutes ago   Up 6 minutes   0.0.0.0:5432->5432/tcp, :::5432->5432/tcp   pg-server





• создать ВМ с Ubuntu 20.04/22.04 или развернуть докер любым удобным способом
• поставить на нем Docker Engine
• сделать каталог /var/lib/postgres
• развернуть контейнер с PostgreSQL 15 смонтировав в него /var/lib/postgresql
• развернуть контейнер с клиентом postgres
• подключится из контейнера с клиентом к контейнеру с сервером и сделать
таблицу с парой строк
• подключится к контейнеру с сервером с ноутбука/компьютера извне инстансов GCP/ЯО/места установки
докера
• удалить контейнер с сервером
• создать его заново
• подключится снова из контейнера с клиентом к контейнеру с сервером
• проверить, что данные остались на месте
• оставляйте в ЛК ДЗ комментарии что и как вы делали и как боролись с проблемами
