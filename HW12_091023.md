# –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞ ‚Ññ12 (–∫ –∑–∞–Ω—è—Ç–∏—é –æ—Ç 09.10.23)
[–°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã]

- [x] –ò—Å–ø–æ–ª—å–∑—É—é —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã "postgres2" —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ YC (–û–°:Ubuntu 22.04, HDD 10Gb, RAM 4Gb);
- [x] –î–æ–±–∞–≤–ª–µ–Ω ssh –∫–ª—é—á –≤ metadata –í–ú yc_key.pub;
- [x] –†–∞–∑–≤–µ—Ä–Ω—É—Ç –∫–ª–∞—Å—Ç–µ—Ä –ë–î PostgreSQL 15;

`silunsky@postgres:~$ pg_lsclusters`

`Ver Cluster Port Status Owner    Data directory              Log file`

`15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log`

- [x] –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—É—é –±–∞–∑—É –ü–µ—Ä–µ–ª–µ—Ç—ã.
‚ö†Ô∏è –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–∑—è—Ç–∞ —Å edu.postgrespro.ru: demo-big.zip (232 –ú–ë) ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–ª—ë—Ç–∞–º –∑–∞ –≥–æ–¥ (—Ä–∞–∑–º–µ—Ä –ë–î –æ–∫–æ–ª–æ 2,5 –ì–ë)
–§–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç SQL-—Å–∫—Ä–∏–ø—Ç, —Å–æ–∑–¥–∞—é—â–∏–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö demo –∏ –Ω–∞–ø–æ–ª–Ω—è—é—â–∏–π –µ—ë –¥–∞–Ω–Ω—ã–º–∏ (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏, —ç—Ç–æ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —É—Ç–∏–ª–∏—Ç–æ–π pg_dump). –í–ª–∞–¥–µ–ª—å—Ü–µ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö demo —Å—Ç–∞–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –°–£–ë–î, –≤—ã–ø–æ–ª–Ω—è–≤—à–∏–π —Å–∫—Ä–∏–ø—Ç. 
–í –∫–ª–∞—Å—Ç–µ—Ä–µ `15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log`
—Å–æ–∑–¥–∞–Ω–∞ –ë–î **demo**

`demo=# \dt`

List of relations

|  Schema  |      Name       | Type  |  Owner   |
|----------|-----------------|-------|----------|
| bookings | aircrafts_data  | table | postgres |
| bookings | airports_data   | table | postgres |
| bookings | boarding_passes | table | postgres |
| bookings | bookings        | table | postgres |
| bookings | flights         | table | postgres |
| bookings | seats           | table | postgres |
| bookings | ticket_flights  | table | postgres |
| bookings | tickets         | table | postgres |
(8 rows)

`demo=# select pg_size_pretty(pg_table_size('flights'));`

| pg_size_pretty | 
|----------------|
| 21 MB          |
(1 row)

`demo=# select pg_size_pretty(pg_table_size('tickets'));`

| pg_size_pretty  | 
|---------------- |
| 386 MB          |
(1 row)

`demo=# select pg_size_pretty(pg_table_size('bookings'));`

| pg_size_pretty| 
|---------------|
| 105 MB        |
(1 row)

- [x] –ü—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ –æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Ç–∞–±–ª–∏—Ü **bookings** –∏ **tickets** –±–∞–∑—ã –¥–≤–Ω–Ω—ã—Ö **demo**

`demo=# \d bookings`

Table "bookings.bookings"
|    Column    |           Type           | Collation | Nullable | Default |
|--------------|--------------------------|-----------|----------|---------|
| book_ref     | character(6)             |           | not null |         |
| book_date    | timestamp with time zone |           | not null |         |
| total_amount | numeric(10,2)            |           | not null |         |
|Indexes:     "bookings_pkey" PRIMARY KEY, btree (book_ref)|
|Referenced by:     TABLE "tickets" CONSTRAINT "tickets_book_ref_fkey" FOREIGN KEY (book_ref) REFERENCES bookings(book_ref)|

`demo=# \d tickets`

Table "bookings.tickets"
|     Column     |         Type          | Collation | Nullable | Default |
|----------------|-----------------------|-----------|----------|---------|
| ticket_no      | character(13)         |           | not null |         |
| book_ref       | character(6)          |           | not null |         | 
| passenger_id   | character varying(20) |           | not null |         |
| passenger_name | text                  |           | not null |         |
| contact_data   | jsonb                 |           |          |         |
|Indexes:     "tickets_pkey" PRIMARY KEY, btree (ticket_no)|
|Foreign-key constraints:     "tickets_book_ref_fkey" FOREIGN KEY (book_ref) REFERENCES bookings(book_ref)|
|Referenced by:     TABLE "ticket_flights" CONSTRAINT "ticket_flights_ticket_no_fkey" FOREIGN KEY (ticket_no) REFERENCES tickets(ticket_no)|

- [x] –¢–µ–ø–µ—Ä—å, –ø–æ–Ω–∏–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–¥–µ–ª–∞–µ–º —Ç–∞–±–ª–∏—Ü—É **bookings** —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏–º —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

–°–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É **bookings_range**

`demo=# CREATE TABLE bookings_range (`
 
     `  book_ref     character(6),`

     `  book_date    timestamptz,`
     
     `  total_amount numeric(10,2)`

 `  ) PARTITION BY RANGE(book_date);`
 
CREATE TABLE

`demo=# \d bookings_range `

Partitioned table "bookings.bookings_range"
|    Column    |           Type           | Collation | Nullable | Default |
|--------------|--------------------------|-----------|----------|---------|
| book_ref     | character(6)             |           |          |         |
| book_date    | timestamp with time zone |           |          |         |
| total_amount | numeric(10,2)            |           |          |         |
|Partition key: RANGE (book_date)|
|Number of partitions: 0|

- –°–æ–∑–¥–∞–¥–∏–º —Å–µ–∫—Ü–∏–∏(–ø–∞—Ä—Ç–∏—Ü–∏–∏) –Ω–∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü:

`demo=# CREATE TABLE bookings_range_201706 PARTITION OF bookings_range `

` FOR VALUES FROM ('2017-06-01'::timestamptz) TO ('2017-07-01'::timestamptz);`

CREATE TABLE

`demo=# CREATE TABLE bookings_range_201707 PARTITION OF bookings_range `

`FOR VALUES FROM ('2017-07-01'::timestamptz) TO ('2017-08-01'::timestamptz);`

CREATE TABLE

`demo=# CREATE TABLE bookings_range_201606 PARTITION OF bookings_range `

` FOR VALUES FROM ('2016-06-01'::timestamptz) TO ('2016-07-01'::timestamptz);`
      
CREATE TABLE

`demo=# CREATE TABLE bookings_range_201607 PARTITION OF bookings_range `

`  FOR VALUES FROM ('2016-07-01'::timestamptz) TO ('2016-08-01'::timestamptz);`

CREATE TABLE

`demo=# CREATE TABLE bookings_range_201608 PARTITION OF bookings_range `

 `FOR VALUES FROM ('2016-08-01'::timestamptz) TO ('2016-09-01'::timestamptz);`
       
CREATE TABLE

`demo=# CREATE TABLE bookings_range_201609 PARTITION OF bookings_range `

` FOR VALUES FROM ('2016-09-01'::timestamptz) TO ('2016-10-01'::timestamptz);`

CREATE TABLE

`demo=# CREATE TABLE bookings_range_201610 PARTITION OF bookings_range `

`  FOR VALUES FROM ('2016-10-01'::timestamptz) TO ('2016-11-01'::timestamptz);`
     
CREATE TABLE

- –î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü —Å–µ–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –Ω–æ –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏. –ó–Ω–∞—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ–∫—Ü–∏–∏
 –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ:

`demo=# CREATE TABLE bookings_range_201708 PARTITION OF bookings_range `

`FOR VALUES FROM (to_timestamp('01.08.2017','DD.MM.YYYY'))` 
       
` TO (to_timestamp('01.09.2017','DD.MM.YYYY'));`

CREATE TABLE

–ò —Ç–∞–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞(–ø–µ—Ä–∏–æ–¥–∞ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)

- –¢–µ–ø–µ—Ä—å, –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã **bookings_range** –ø–æ—Å–ª–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

`demo=# \d+ bookings_range`

Partitioned table "bookings.bookings_range"
|    Column    |           Type           | Collation | Nullable | Default | Storage  | Compression | Stats target | Description |
|--------------|--------------------------|-----------|----------|---------|----------|-------------|--------------|-------------|
| book_ref     | character(6)             |           |          |         | extended |             |              |             | 
| book_date    | timestamp with time zone |           |          |         | plain    |             |              |             |
| total_amount | numeric(10,2)            |           |          |         | main     |             |              |             |

Partition key: RANGE (book_date)

Partitions: bookings_range_201606 FOR VALUES FROM ('2016-06-01 00:00:00+00') TO ('2016-07-01 00:00:00+00'),

bookings_range_201607 FOR VALUES FROM ('2016-07-01 00:00:00+00') TO ('2016-08-01 00:00:00+00'),
            
bookings_range_201608 FOR VALUES FROM ('2016-08-01 00:00:00+00') TO ('2016-09-01 00:00:00+00'),

bookings_range_201609 FOR VALUES FROM ('2016-09-01 00:00:00+00') TO ('2016-10-01 00:00:00+00'),

bookings_range_201610 FOR VALUES FROM ('2016-10-01 00:00:00+00') TO ('2016-11-01 00:00:00+00'),

bookings_range_201706 FOR VALUES FROM ('2017-06-01 00:00:00+00') TO ('2017-07-01 00:00:00+00'),

bookings_range_201707 FOR VALUES FROM ('2017-07-01 00:00:00+00') TO ('2017-08-01 00:00:00+00'),

bookings_range_201708 FOR VALUES FROM ('2017-08-01 00:00:00+00') TO ('2017-09-01 00:00:00+00')

- –í—Å–µ, —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –ù–µ –Ω—É–∂–µ–Ω —Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞ –≤—Å—Ç–∞–≤–∫—É –∑–∞–ø–∏—Å–µ–π, –Ω–µ –Ω—É–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è `CHECK`. –ü–∞—Ä–∞–º–µ—Ç—Ä `CONSTRAINT_EXCLUSION` —Ç–∞–∫–∂–µ –Ω–µ –Ω—É–∂–µ–Ω, –µ–≥–æ –¥–∞–∂–µ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å

`demo=# SET constraint_exclusion = OFF;`

SET

–ü—Ä–æ–≤–µ—Ä–∏–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–æ–π –ø–æ —Å–µ–∫—Ü–∏—è–º(–ø–∞—Ä—Ç–∏—Ü–∏—è–º):

`demo=# INSERT INTO bookings_range SELECT * FROM bookings;`

INSERT 0 2111110

- –ó–∞ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –ø–æ—ç—Ç–æ–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –ø–æ —Å–µ–∫—Ü–∏—è–º –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø—Ä–æ—Å–æ–º:

`demo=# SELECT tableoid::regclass, count(*) FROM bookings_range GROUP BY tableoid;`

|       tableoid        | count  | 
|-----------------------|--------|
| bookings_range_201708 |  87790 |
| bookings_range_201608 | 168470 |
| bookings_range_201707 | 171671 |
| bookings_range_201705 | 170952 |
| bookings_range_201612 | 171290 |
| bookings_range_201609 | 165419 |
| bookings_range_201610 | 170925 |
| bookings_range_201703 | 171260 |
| bookings_range_201611 | 165437 |
| bookings_range_201706 | 165213 |
| bookings_range_201702 | 154598 |
| bookings_range_201701 | 171206 |
| bookings_range_201704 | 165485 |
| bookings_range_201607 |  11394 |
(14 rows)

- –ü—Ä–∏ —ç—Ç–æ–º –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç:

`demo=# SELECT * FROM ONLY bookings_range;`

| book_ref | book_date | total_amount |
|----------|-----------|--------------|
(0 rows)


`demo=# EXPLAIN (COSTS OFF) `

`SELECT * FROM bookings_range WHERE book_date = '2016-07-01'::timestamptz;`

|QUERY PLAN                                                                  |
|----------------------------------------------------------------------------|
| Seq Scan on bookings_range_201607 bookings_range |
| Filter: (book_date = '2016-07-01 00:00:00+00'::timestamp with time zone)|
(2 rows)

- –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–µ–∫—Ü–∏–π. –ü–æ—ç—Ç–æ–º—É –≤ –ø–ª–∞–Ω–µ –∑–∞–ø—Ä–æ—Å–∞ –º—ã –≤–∏–¥–∏–º —É–∑–µ–ª SORT –∏ –≤—ã—Å–æ–∫—É—é –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–ª–∞–Ω–∞:

`demo=# EXPLAIN SELECT * FROM bookings_range ORDER BY book_date;`

| QUERY PLAN                                                                                                 |
|------------------------------------------------------------------------------------------------------------|
| Sort  (cost=343317.14..348600.02 rows=2113150 width=21)|
|   Sort Key: bookings_range.book_date|
|   ->  Append  (cost=0.00..45171.25 rows=2113150 width=21)|
|         ->  Seq Scan on bookings_range_201603 bookings_range_1  (cost=0.00..20.20 rows=1020 width=52)
|         ->  Seq Scan on bookings_range_201607 bookings_range_2  (cost=0.00..186.94 rows=11394 width=21)
|         ->  Seq Scan on bookings_range_201608 bookings_range_3  (cost=0.00..2758.70 rows=168470 width=21)
|         ->  Seq Scan on bookings_range_201609 bookings_range_4  (cost=0.00..2708.19 rows=165419 width=21)
|         ->  Seq Scan on bookings_range_201610 bookings_range_5  (cost=0.00..2798.25 rows=170925 width=21)
|         ->  Seq Scan on bookings_range_201611 bookings_range_6  (cost=0.00..2708.37 rows=165437 width=21)
|         ->  Seq Scan on bookings_range_201612 bookings_range_7  (cost=0.00..2804.90 rows=171290 width=21)
|         ->  Seq Scan on bookings_range_201701 bookings_range_8  (cost=0.00..2803.06 rows=171206 width=21)
|         ->  Seq Scan on bookings_range_201702 bookings_range_9  (cost=0.00..2530.98 rows=154598 width=21)
|         ->  Seq Scan on bookings_range_201703 bookings_range_10  (cost=0.00..2803.60 rows=171260 width=21)
|         ->  Seq Scan on bookings_range_201704 bookings_range_11  (cost=0.00..2709.85 rows=165485 width=21)
|         ->  Seq Scan on bookings_range_201705 bookings_range_12  (cost=0.00..2798.52 rows=170952 width=21)
|         ->  Seq Scan on bookings_range_201706 bookings_range_13  (cost=0.00..2705.13 rows=165213 width=21)
|         ->  Seq Scan on bookings_range_201707 bookings_range_14  (cost=0.00..2810.71 rows=171671 width=21)
|         ->  Seq Scan on bookings_range_201708 bookings_range_15  (cost=0.00..1437.90 rows=87790 width=21)
|         ->  Seq Scan on bookings_range_201709 bookings_range_16  (cost=0.00..20.20 rows=1020 width=52)
(19 rows)

- –°–æ–∑–¥–∞–¥–∏–º –∏–Ω–¥–µ–∫—Å –ø–æ book_date. –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞, —Å–æ–∑–¥–∞—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã –≤ –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏:

`demo=# CREATE INDEX book_date_idx ON bookings_range(book_date);`

CREATE INDEX

`demo=# \di bookings_range*`

List of relations
|  Schema  |                Name                 | Type  |  Owner   |         Table         |
|----------|-------------------------------------|-------|----------|-----------------------|
 bookings | bookings_range_201603_book_date_idx | index | postgres | bookings_range_201603  |
 bookings | bookings_range_201607_book_date_idx | index | postgres | bookings_range_201607  |
 bookings | bookings_range_201608_book_date_idx | index | postgres | bookings_range_201608  |
 bookings | bookings_range_201609_book_date_idx | index | postgres | bookings_range_201609  |
 bookings | bookings_range_201610_book_date_idx | index | postgres | bookings_range_201610  |
 bookings | bookings_range_201611_book_date_idx | index | postgres | bookings_range_201611  |
 bookings | bookings_range_201612_book_date_idx | index | postgres | bookings_range_201612  |
 bookings | bookings_range_201701_book_date_idx | index | postgres | bookings_range_201701  |
 bookings | bookings_range_201702_book_date_idx | index | postgres | bookings_range_201702  |
 bookings | bookings_range_201703_book_date_idx | index | postgres | bookings_range_201703  |
 bookings | bookings_range_201704_book_date_idx | index | postgres | bookings_range_201704  |
 bookings | bookings_range_201705_book_date_idx | index | postgres | bookings_range_201705  |
 bookings | bookings_range_201706_book_date_idx | index | postgres | bookings_range_201706  |
 bookings | bookings_range_201707_book_date_idx | index | postgres | bookings_range_201707  |
 bookings | bookings_range_201708_book_date_idx | index | postgres | bookings_range_201708  |
 bookings | bookings_range_201709_book_date_idx | index | postgres | bookings_range_201709  |
(16 rows)



- –ü—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—Ä–æ—Å —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å –ø–æ –∫–ª—é—á—É —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—ã–¥–∞–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–µ–∫—Ü–∏–π —Å—Ä–∞–∑—É –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –£–∑–µ–ª SORT –Ω–µ –Ω—É–∂–µ–Ω –∏ –¥–ª—è –≤—ã–¥–∞—á–∏ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã:

|  QUERY PLAN                                                                    
|--------------------------------------------------------------------------------------------------------------------------------------------------
| Append  (cost=4.42..60847.49 rows=2113150 width=21)
|   ->  Index Scan using bookings_range_201603_book_date_idx on bookings_range_201603 bookings_range_1  (cost=0.15..27.55 rows=1020 width=52)
|   ->  Index Scan using bookings_range_201607_book_date_idx on bookings_range_201607 bookings_range_2  (cost=0.29..281.19 rows=11394 width=21)
|   ->  Index Scan using bookings_range_201608_book_date_idx on bookings_range_201608 bookings_range_3  (cost=0.29..4010.14 rows=168470 width=21)
|   ->  Index Scan using bookings_range_201609_book_date_idx on bookings_range_201609 bookings_range_4  (cost=0.29..3934.68 rows=165419 width=21)
|   ->  Index Scan using bookings_range_201610_book_date_idx on bookings_range_201610 bookings_range_5  (cost=0.29..4065.67 rows=170925 width=21)
|   ->  Index Scan using bookings_range_201611_book_date_idx on bookings_range_201611 bookings_range_6  (cost=0.29..3936.05 rows=165437 width=21)
|   ->  Index Scan using bookings_range_201612_book_date_idx on bookings_range_201612 bookings_range_7  (cost=0.29..4074.44 rows=171290 width=21)
|   ->  Index Scan using bookings_range_201701_book_date_idx on bookings_range_201701 bookings_range_8  (cost=0.29..4072.08 rows=171206 width=21)
|   ->  Index Scan using bookings_range_201702_book_date_idx on bookings_range_201702 bookings_range_9  (cost=0.29..3677.76 rows=154598 width=21)
|   ->  Index Scan using bookings_range_201703_book_date_idx on bookings_range_201703 bookings_range_10  (cost=0.29..4072.89 rows=171260 width=21)
|   ->  Index Scan using bookings_range_201704_book_date_idx on bookings_range_201704 bookings_range_11  (cost=0.29..3936.77 rows=165485 width=21)
|   ->  Index Scan using bookings_range_201705_book_date_idx on bookings_range_201705 bookings_range_12  (cost=0.29..4066.07 rows=170952 width=21)
|   ->  Index Scan using bookings_range_201706_book_date_idx on bookings_range_201706 bookings_range_13  (cost=0.29..3930.49 rows=165213 width=21)
|   ->  Index Scan using bookings_range_201707_book_date_idx on bookings_range_201707 bookings_range_14  (cost=0.29..4083.46 rows=171671 width=21)
|   ->  Index Scan using bookings_range_201708_book_date_idx on bookings_range_201708 bookings_range_15  (cost=0.29..2084.93 rows=87790 width=21)
|   ->  Index Scan using bookings_range_201709_book_date_idx on bookings_range_201709 bookings_range_16  (cost=0.15..27.55 rows=1020 width=52)
(17 rows)

üòÑ **–¢–µ–º–∞ –º–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–∞ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ**
