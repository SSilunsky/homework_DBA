# –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞ ‚Ññ9 (–∫ –∑–∞–Ω—è—Ç–∏—é –æ—Ç 18.09.23)
[–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ]

- [x] –ò—Å–ø–æ–ª—å–∑—É—é —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã "postgres2" —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ YC (–û–°:Ubuntu 22.04, HDD 10Gb, RAM 4Gb);
- [x] –î–æ–±–∞–≤–ª–µ–Ω ssh –∫–ª—é—á –≤ metadata –í–ú yc_key.pub;
- [x] –†–∞–∑–≤–µ—Ä–Ω—É—Ç –∫–ª–∞—Å—Ç–µ—Ä –ë–î PostgreSQL 15;

`silunsky@postgres:~$ pg_lsclusters`

`Ver Cluster Port Status Owner    Data directory              Log file`

`15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log`

- [x] –í –ë–î **silunsky_db** —Å–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É **otus100** –ó–∞–ø–æ–ª–Ω–∏–º —Ç–∞–±–ª–∏—Ü—É **otus100** –∞–≤—Ç–æ—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ 100 –∑–∞–ø–∏—Å—è–º–∏.

- –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ –Ω—É–∂–Ω–æ–º –Ω–∞–º –∫–ª–∞—Å—Ç–µ—Ä–µ, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É:

`postgres=# SELECT current_setting('cluster_name'), current_setting('server_version');`

| current_setting |         current_setting          |
|-----------------|----------------------------------|
| 15/main         | 15.4 (Ubuntu 15.4-1.pgdg22.04+1) |
(1 row)

- –ü–æ–¥–∫–ª—é—á–∏–º—Å—è –∫ –ë–î **silunsky_db** –∏ —Å–æ–∑–¥–∞–¥–∏–º –≤ –Ω–µ–π —Ç–∞–±–ª–∏—Ü—É **otus100**

`silunsky_db=# create table otus100 as`

`select`

`generate_series(1,100) as id,`

`md5(random()::text)::char(10) as fio;`

`silunsky_db=# \dt`

List of relations

| Schema |       Name       | Type  |  Owner   |
|--------|------------------|-------|----------|
| public | otus100          | table | postgres |


- [x] –ü–æ–¥ –ª–∏–Ω—É–∫—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º Postgres —Å–æ–∑–¥–∞–¥–∏–º –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –±—ç–∫–∞–ø–æ–≤ **/mnt/pg_tmp** 

`postgres@postgres2:~$ ls -la /mnt/`

total 32

drwxr-xr-x  5 postgres root      4096 Sep 19 06:21 .

drwxr-xr-x 19 root     root      4096 Sep 19 05:56 ..

drwxrwxr-x  3 postgres postgres  4096 Aug 22 10:54 data

drwx------  2 root     root     16384 Aug 22 07:10 lost+found

drwxrwxr-x  2 postgres postgres  4096 Sep 19 06:21 pg_tmp

- [x] –°–æ–∑–¥–∞–¥–∏–º –ø—É—Å—Ç—É—é —Ç–∞–±–ª–∏—Ü—É **otus101**:

`silunsky_db=# create table otus101 (id int, fio text);`

CREATE TABLE

`silunsky_db=# select * from otus101;`

| id | fio | 
|----|-----|
(0 rows)

- [x] –°–¥–µ–ª–∞–µ–º –ª–æ–≥–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø —Ç–∞–±–ª–∏—Ü—ã **otus100** –∏—Å–ø–æ–ª—å–∑—É—è —É—Ç–∏–ª–∏—Ç—É **COPY**:

`silunsky_db=# \copy otus100 to '/mnt/pg_tmp/copy100.sql';`

COPY 100

- –ü—Ä–æ–≤–µ—Ä–∏–º —É—Å–ø–µ—à–Ω–æ –ª–∏ —Å–æ–∑–¥–∞–ª—Å—è –±—ç–∫–∞–ø:

`postgres@postgres2:~$ ls -la /mnt/pg_tmp/`

total 12

drwxrwxr-x 2 postgres postgres 4096 Sep 19 06:39 .

drwxr-xr-x 5 postgres root     4096 Sep 19 06:21 ..

-rw-rw-r-- 1 postgres postgres 1392 Sep 19 06:39 copy100.sql

- [x] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º –≤ —Ç–∞–±–ª–∏—Ü—É —Ç–∞–±–ª–∏—Ü—É **otus101** –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—ç–∫–∞–ø–∞ **/mnt/pg_tmp/copy100.sql**, —Å –ø–æ–º–æ—â—å—é —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥—ã:

`silunsky_db=# \copy otus101 from '/mnt/pg_tmp/copy100.sql';`

COPY 100

- –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –≤—Å–µ —Ö–æ—Ä–æ—à–æ, –≤—ã–ø–æ–ª–Ω–∏–≤ –ø—Ä–æ—Å—Ç–æ–π select:

`silunsky_db=# select * from otus101`

`silunsky_db-# limit 5;`

| id |    fio     |
|----|------------|
|  1 | 57beef4694 |
|  2 | 786a7e9e5d |
|  3 | a7fabaf297 |
|  4 | c7cdfcf41c |
|  5 | 94a899ebf6 |
(5 rows)

–î–∞–Ω–Ω—ã–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ üòÑ

---

- [x] –ò—Å–ø–æ–ª—å–∑—É—è —É—Ç–∏–ª–∏—Ç—É pg_dump —Å–æ–∑–¥–∞–¥–∏–º –±—ç–∫–∞–ø –ë–î **silunsky_db** –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

`postgres@postgres2:~$ pg_dump -d silunsky_db -Fc > /mnt/silunsky_db.gz `

`postgres@postgres2:~$ ls -lah /mnt/`

total 11M
- drwxr-xr-x  5 postgres root     4.0K Sep 19 07:59 .
- drwxr-xr-x 19 root     root     4.0K Sep 19 05:56 ..
- drwxrwxr-x  3 postgres postgres 4.0K Aug 22 10:54 data
- drwx------  2 root     root      16K Aug 22 07:10 lost+found
- drwxrwxr-x  2 postgres postgres 4.0K Sep 19 06:39 pg_tmp
- -rw-rw-r--  1 postgres postgres 5.2M Sep 19 07:59 silunsky_db.gz

- –£–¥–∞–ª–∏–º —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–ø–Ω–Ω—É—é –ë–î **silunsky_db**

`postgres@postgres2:~$ echo "DROP DATABASE silunsky_db;" | psql -U postgres`

DROP DATABASE

- –°–æ–∑–¥–∞–¥–∏–º –ë–î –∑–∞–Ω–æ–≤–æ, –ø—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –æ–Ω–∞ –ø—É—Å—Ç–∞ –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π:

`postgres=# CREATE DATABASE silunsky_db;`

CREATE DATABASE

`postgres=# \c silunsky_db`

You are now connected to database "silunsky_db" as user "postgres".

`silunsky_db=# \dt`

###Did not find any relations.

- [x] –ò—Å–ø–æ–ª—å–∑—É—è —É—Ç–∏–ª–∏—Ç—É pg_restore –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º –≤ –Ω–æ–≤—É—é –ë–î:

`postgres@postgres2:~$ pg_restore -d silunsky_db -U postgres /mnt/silunsky_db.gz`

`postgres=# \c silunsky_db`

You are now connected to database "silunsky_db" as user "postgres".

- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
  
`silunsky_db=# \dt`

List of relations
| Schema |       Name       | Type  |  Owner   | 
|--------|------------------|-------|----------|
| public | otus100          | table | postgres |
| public | otus101          | table | postgres |
 
`silunsky_db=# select * from otus101`

`silunsky_db-# limit 5;`

| id |    fio     |
|----|------------|
|  1 | 57beef4694 |
|  2 | 786a7e9e5d |
|  3 | a7fabaf297 |
|  4 | c7cdfcf41c |
|  5 | 94a899ebf6 |
(5 rows)

–î–∞–Ω–Ω—ã–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ üòÑ

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: –§–ª–∞–≥ -t —É—Ç–∏–ª–∏—Ç—ã pg_restore –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–µ —Å–æ–≤—Å–µ–º —Ç–∞–∫, –∫–∞–∫ —Ñ–ª–∞–≥ -t —É—Ç–∏–ª–∏—Ç—ã pg_dump. –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è pg_restore –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ –º–∞—Å–∫–µ, –∞ —Ç–∞–∫–∂–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –∏–º—è —Å—Ö–µ–º—ã —Å -t. –ò —Ö–æ—Ç—è pg_dump —Å —Ñ–ª–∞–≥–æ–º -t —Ç–∞–∫–∂–µ –≤—ã–≥—Ä—É–∂–∞–µ—Ç –ø–æ–¥—á–∏–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–Ω–¥–µ–∫—Å—ã) –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü, pg_restore —Å —Ñ–ª–∞–≥–æ–º -t —Ç–∞–∫–∏–µ –ø–æ–¥—á–∏–Ω—ë–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.
