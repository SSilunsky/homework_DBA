# –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞ ‚Ññ3 (–∫ –∑–∞–Ω—è—Ç–∏—é –æ—Ç 21.08.23)

- [x] C–æ–∑–¥–∞–Ω –∏–Ω—Å—Ç–∞–Ω—Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã "postgres" —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ YC (–û–°:Ubuntu 22.04, HDD 10Gb, RAM 4Gb);
- [x] –î–æ–±–∞–≤–ª–µ–Ω ssh –∫–ª—é—á –≤ metadata –í–ú yc_key.pub
- [x] –†–∞–∑–≤–µ—Ä–Ω—É—Ç –∫–ª–∞—Å—Ç–µ—Ä –ë–î PostgreSQL 15

`silunsky@postgres:~$ pg_lsclusters`

`Ver Cluster Port Status Owner    Data directory              Log file`

`15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log`

- [x] –°–æ–∑–¥–∞–Ω–∞ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `silunsky_db`

postgres=# \l

                                                  List of databases
      
|   Name      |  Owner   | Encoding |   Collate   |    Ctype    | ICU Locale | Locale Provider |   Access privileges   |
|-------------|----------|----------|-------------|-------------|------------|-----------------|-----------------------|
| postgres    | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            |                       |
| **silunsky_db** | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            |                       |
 
---
 
- [x] –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ "**otus**"

silunsky_db=# \dt

        List of relations    
| Schema | Name | Type  |  Owner  |  
|--------|------|-------|---------|
| public | **otus** | table | postgres|
 
(1 row)

---

- [x] –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–æ–ª–Ω–∏–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏.

`silunsky_db=# SELECT * FROM otus;`

| i | amount | 
|---|--------|
| 1 |    100 |
| 2 |    200 |
| 3 |    300 |
| 4 |    500 | 

(4 rows)

---

- [x] –í YC —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –¥–∏—Å–∫ "**disk2**"(/dev/vdb) –æ–±—ä–µ–º–æ–º 11 –ì–ë, –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –í–ú "**postgres**", –¥–∏—Å–∫ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω –∏ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ **/mnt/disk2**

silunsky@postgres:~$ lsblk -f

NAME   FSTYPE   FSVER LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS

vda                                                                             
‚îú‚îÄvda1                                                                          
‚îî‚îÄvda2 ext4     1.0         ed465c6e-049a-41c6-8e0b-c8da348a3577    4.1G    53% /
vdb    ext4     1.0         224c5efb-4cfd-41c2-af26-2c2af04a45d8   10.2G     0% /mnt/disk2

- [x] –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ **/mnt/disk2** —Å–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è **/mnt/disk2/data** —Å –¥–∏—Å–∫—Ä–µ—Ü–∏–æ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "postgres"

`silunsky@postgres:/mnt/disk2$ ls -l`

`total 20`

`drwxrwxr-x 2 postgres postgres  4096 Aug 22 07:58 data`

---
- [x] –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ö–ª–∞—Å—Ç–µ—Ä –ë–î

`silunsky@postgres:~$ sudo -u postgres pg_ctlcluster 15 main stop`

`silunsky@postgres:~$ pg_lsclusters `

`Ver Cluster Port Status Owner    Data directory              Log file`

`15  main    5432 down   postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log`

- [x] –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ **/var/lib/postgresql/15/** –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é **/mnt/disk2/data/**

`postgres@postgres:~$ ls -l /mnt/disk2/data/`

`drwxr-xr-x 3 postgres postgres 4096 Aug 21 06:19 15` 

- [x] –û—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∞ –ø–æ–ø—ã–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ö–ª–∞—Å—Ç–µ—Ä–∞ –ë–î.
      
–ü–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

`postgres@postgres:/home/silunsky$ pg_ctlcluster 15 main start`

`Error: /var/lib/postgresql/15/main is not accessible or does not exist`

–î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª: `/etc/postgresql/15/main/postgresql.conf`
–∞ –∏–º–µ–Ω–Ω–æ:
- –Ω–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `data_directory = '/var/lib/postgresql/15/main'`
- —É–∫–∞–∑–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º –¥–∏—Å–∫–µ, –ø—Ä–∏–≤–µ–¥—è —Å—Ç—Ä–æ–∫—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–∏–¥—É:
  
`data_directory = '/mnt/disk2/data/15/main'              # use data in another directory`

- —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è;
- –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –ë–î, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É:

  `silunsky@postgres:~$ sudo -u postgres pg_ctlcluster 15 main start`
  
- –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ö–ª–∞—Å—Ç–µ—Ä–∞ –ë–î, –∫–æ–º–∞–Ω–¥–æ–π:
  
`postgres@postgres:/home/silunsky$ pg_ctlcluster 15 main status`

`pg_ctl: server is running (PID: 1305)`

–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–∞ –ë–î –≤ –Ω–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ **/mnt/disk2/data/**, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É:

`silunsky@postgres:~$ pg_lsclusters`

`Ver Cluster Port Status Owner    Data directory          Log file`

`15  main    5432 online postgres /mnt/disk2/data/15/main /var/log/postgresql/postgresql-15-main.log`

- [x] –í—ã–ø–æ–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î –∏ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é **/mnt/disk2/data/**
      
`silunsky_db=# SHOW data_directory;`

|data_directory   |
|-------------------------|
| /mnt/disk2/data/15/main |

(1 row)

–î–æ—Å—Ç—É–ø–Ω–æ üòÉ
- [x] —Ç–∞–±–ª–∏—Ü–∞ "**otus**"

silunsky_db=# \dt

        List of relations    
| Schema | Name | Type  |  Owner  |  
|--------|------|-------|---------|
| public | **otus** | table | postgres|
 
(1 row)

---

- [x] –¢–∞–±–ª–∏—Ü–∞ c –¥–∞–Ω–Ω—ã–º–∏, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Ä–∞–Ω–µ–µ.

`silunsky_db=# SELECT * FROM otus;`

| i | amount | 
|---|--------|
| 1 |    100 |
| 2 |    200 |
| 3 |    300 |
| 4 |    500 | 

(4 rows)

