# Домашняя работа №6 (к занятию от 31.08.23)
[Работа с журналами]

- [x] Использую ранее созданный инстанс виртуальной машины "postgres2" с дефолтными параметрами в YC (ОС:Ubuntu 22.04, HDD 10Gb, RAM 4Gb);
- [x] Добавлен ssh ключ в metadata ВМ yc_key.pub;
- [x] Развернут кластер БД PostgreSQL 15;

`silunsky@postgres:~$ pg_lsclusters`

`Ver Cluster Port Status Owner    Data directory              Log file`

`15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log`

Для тестов используется ранее созданная БД **silunsky** и таблица **otus**

postgres@postgres2:~$ psql 

psql (15.4 (Ubuntu 15.4-1.pgdg22.04+1))

Type "help" for help.

`postgres=# \c silunsky_db `

You are now connected to database "silunsky_db" as user "postgres".

`silunsky_db=# select * from otus;`

| i | amount | 
|---|--------|
| 1 |    100 |
| 2 |    200 |
| 3 |    300 |
| 4 |    500 |
(4 rows)

- [x] Настроил выполнение контрольной точки раз в 30 секунд, выставив в конфигурационном файле `/etc/postgresql/15/main/postgresql.conf` параметр `checkpoint_timeout = 30s`
- [x] Запустил проверку тест производительности с параметрами: `pgbench -c8 -P 6 -T 600 -U postgres postgres`

где:

-c8 # Число имитируемых клиентов, то есть число одновременных сеансов базы данных;

-P 6 # выводит отчёт о прогрессе через заданное число секунд (сек);

-T 600 # выполняет тест с ограничением по времени 10 минут(в секундах), а не по числу транзакций для каждого клиента. 

`postgres@postgres2:~$ pgbench -c8 -P 6 -T 60 -U postgres postgres`

pgbench (15.4 (Ubuntu 15.4-1.pgdg22.04+1))

starting vacuum...end.

transaction type: <builtin: TPC-B (sort of)>

scaling factor: 1

query mode: simple

number of clients: 8

number of threads: 1

maximum number of tries: 1

duration: 600 s

number of transactions actually processed: 224768

number of failed transactions: 0 (0.000%)

latency average = 21.355 ms

latency stddev = 19.306 ms

initial connection time = 14.590 ms

tps = 374.601759 (without initial connection time)



- [x] Применил параметры настройки PostgreSQL из прикрепленного к материалам занятия файла - увеличив количество max_workers с 3 до 5
Протестировал заново. За счет этого немного повысилась производительность:
